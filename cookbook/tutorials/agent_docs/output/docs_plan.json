{
  "table_of_contents": [
    {
      "name": "## 1. Overview of the CRM Touchpoint Data Model",
      "content": "This document provides a comprehensive overview of the GitLab CRM Touchpoint Data Model, designed to unify data from various sources (Salesforce, Marketo, Bizible, Zuora) for in-depth analysis of marketing performance, customer journey, and sales attribution. This model serves as the central analytical hub for understanding the influence of marketing activities across the entire sales funnel.\n\nKey areas covered include detailed marketing touchpoint information, comprehensive customer and account profiles, campaign performance metrics, and the underlying data preparation and mapping logic. The documentation aims to empower data consumers with a clear understanding of the data structure, definitions, and relationships, enabling effective self-service analysis and reporting.\n\n*Diagram: Illustrate the flow of data from source systems (Salesforce, Marketo, Bizible, Zuora) through preparation and dimension/fact models, culminating in the `mart_crm_touchpoint` table as the central analytical output. Highlight core entities: Persons, Accounts, Campaigns, Users, and Touchpoints and their interconnections.*"
    },
    {
      "name": "## 2. The Core Analytical Model: [mart_crm_touchpoint](chapter_200.md)",
      "content": "This chapter details the `mart_crm_touchpoint` table, which serves as the primary analytical model for comprehensive marketing touchpoint analysis. It integrates diverse CRM data points to provide a holistic view of every interaction a person has with GitLab's marketing and sales efforts. This model is crucial for understanding the sequence and impact of touchpoints throughout the customer journey, enabling advanced attribution modeling and performance analysis.\n\nKey content includes:\n*   **Purpose and Value**: Explain how this model unifies disparate data for actionable insights.\n*   **Key Fields**: A detailed breakdown of essential columns, such as `dim_crm_touchpoint_id`, `bizible_touchpoint_date_time`, `bizible_touchpoint_position`, `bizible_marketing_channel_path`, `utm_campaign` (and its parsed components), `integrated_campaign_grouping`, `gtm_motion`, `is_dg_influenced`, `is_dg_sourced`, `is_fmm_influenced`, `is_fmm_sourced`, and various `count_` fields for inquiry, MQL, and accepted stages.\n*   **Joining Logic**: Describe how data from [dim_crm_touchpoint](chapter_350.md), [fct_crm_touchpoint](chapter_410.md), [dim_campaign](chapter_340.md), [fct_campaign](chapter_430.md), [dim_crm_person](chapter_310.md), [fct_crm_person](chapter_420.md), [dim_crm_account](chapter_320.md), and [dim_crm_user](chapter_330.md) are combined.\n*   **Attribution Calculations**: Explain the derivation of fields like `is_fmm_influenced`, `is_fmm_sourced`, and `integrated_budget_holder` based on campaign and touchpoint characteristics.\n*   **Weighted Touchpoints**: Detail the logic for `pre_mql_touches` and `pre_mql_weight` to support weighted attribution models."
    },
    {
      "name": "## 3. Core Dimension Models",
      "content": "This section introduces the foundational dimension models that provide descriptive attributes for entities within the CRM Touchpoint Data Model. These dimensions are essential for segmenting, filtering, and enriching analytical data, allowing for granular insights into marketing and sales performance."
    },
    {
      "name": "### 3.1. [dim_crm_person](chapter_310.md): CRM Person Dimension",
      "content": "This chapter describes the `dim_crm_person` table, a comprehensive dimension for all individuals (leads and contacts) within the CRM system. It consolidates key person-level attributes crucial for understanding their profile and progression through the sales funnel.\n\nKey content includes:\n*   **Person Identifiers**: `dim_crm_person_id`, `sfdc_record_id`, `bizible_person_id`, `marketo_lead_id`, and `email_hash`.\n*   **Demographic and Firmographic Data**: `title`, `country`, `state`, `email_domain`, `employee_bucket`, `account_demographics_sales_segment`, etc.\n*   **Lead Source and Status**: `lead_source`, `lead_source_type`, `status`, `is_mql`, `is_inquiry`.\n*   **Behavioral Scores**: `person_score`, `behavior_score`, `propensity_to_purchase_score_group`.\n*   **Key Lifecycle Dates**: `created_date`, `inquiry_date`, `mql_date_first`, `accepted_date`, `qualified_date`, `converted_date`.\n*   **Sales/Marketing Engagements**: `name_of_active_sequence`, `is_actively_being_sequenced`, `groove_last_engagement_type`, `bizible_mql_marketing_channel`.\n*   **Relationship to other Dimensions**: How it links to [dim_crm_account](chapter_320.md), [dim_crm_user](chapter_330.md), and [dim_bizible_marketing_channel_path](chapter_522.md) through foreign keys."
    },
    {
      "name": "### 3.2. [dim_crm_account](chapter_320.md): CRM Account Dimension",
      "content": "This chapter details the `dim_crm_account` table, providing comprehensive descriptive information about accounts in the CRM system. It supports account-based marketing (ABM) and sales strategies by offering detailed firmographic and engagement data.\n\nKey content includes:\n*   **Account Identifiers**: `dim_crm_account_id`, `dim_parent_crm_account_id`.\n*   **Account Demographics**: `crm_account_name`, `crm_account_billing_country`, `crm_account_industry`, `crm_account_employee_count_band`.\n*   **Sales and GTM Attributes**: `crm_account_gtm_strategy`, `crm_account_focus_account`, `parent_crm_account_sales_segment`, `abm_tier`.\n*   **Health and Engagement Metrics**: `health_number`, `health_score_color`, `six_sense_account_buying_stage`, `qualified_score`.\n*   **Partner Information**: `is_reseller`, `is_focus_partner`, `partner_type`.\n*   **Account Owner Details**: Attributes pulled from [dim_crm_user](chapter_330.md) like `crm_account_owner_user_segment`, `technical_account_manager`.\n*   **Source Data Integration**: How this dimension is built using `prep_crm_account`, `prep_charge_mrr`, and `prep_date` to enrich account data."
    },
    {
      "name": "### 3.3. [dim_crm_user](chapter_330.md): CRM User Dimension",
      "content": "This chapter describes the `dim_crm_user` table, which contains comprehensive information about users within the CRM system, primarily focusing on sales and marketing personnel who interact with customers and campaigns. This dimension is crucial for attributing activities and performance to specific individuals and their organizational hierarchies.\n\nKey content includes:\n*   **User Identifiers**: `dim_crm_user_id`, `employee_number`.\n*   **User Profile**: `user_name`, `title`, `department`, `team`, `user_email`, `is_active`.\n*   **Sales Hierarchy**: `crm_user_sales_segment`, `crm_user_geo`, `crm_user_region`, `crm_user_area`, `crm_user_business_unit`, `user_role_name`.\n*   **Role Levels**: `user_role_level_1` through `user_role_level_5` for detailed organizational structuring.\n*   **Derived Attributes**: `crm_user_sales_segment_grouped`, `crm_user_sales_segment_region_grouped`.\n*   **Source Data**: Details on its derivation from `prep_crm_user`, which processes data from Salesforce user and user role sources."
    },
    {
      "name": "### 3.4. [dim_campaign](chapter_340.md): Campaign Dimension",
      "content": "This chapter details the `dim_campaign` table, which provides descriptive attributes for all marketing and sales campaigns tracked in Salesforce. It enables granular analysis of campaign characteristics, beyond just performance metrics.\n\nKey content includes:\n*   **Campaign Identifiers**: `dim_campaign_id`, `dim_parent_campaign_id`.\n*   **Campaign Details**: `campaign_name`, `is_active`, `status`, `type`, `description`.\n*   **Financial and Strategic Attributes**: `budget_holder`, `strategic_marketing_contribution`, `large_bucket`, `allocadia_id`.\n*   **Partner and Event Specifics**: `is_a_channel_partner_involved`, `is_an_alliance_partner_involved`, `is_this_an_in_person_event`, `alliance_partner_name`, `channel_partner_name`.\n*   **GTM and Planning Details**: `sales_play`, `gtm_motion`, `total_planned_mqls`, `registration_goal`, `attendance_goal`.\n*   **Source Data**: How this dimension is derived from `prep_campaign`, which performs initial cleaning and structuring of raw Salesforce campaign data."
    },
    {
      "name": "### 3.5. [dim_crm_touchpoint](chapter_350.md): CRM Touchpoint Dimension",
      "content": "This chapter describes the `dim_crm_touchpoint` table, focusing on the detailed descriptive attributes of each individual touchpoint a person has with GitLab. This dimension complements the factual `fct_crm_touchpoint` by providing context and granular details about how each interaction occurred.\n\nKey content includes:\n*   **Touchpoint Identifiers**: `dim_crm_touchpoint_id`.\n*   **Date and Time Attributes**: `bizible_touchpoint_date`, `bizible_touchpoint_date_time`, `bizible_touchpoint_month`.\n*   **Touchpoint Characteristics**: `bizible_touchpoint_position`, `bizible_touchpoint_source`, `bizible_touchpoint_source_type`, `bizible_touchpoint_type`.\n*   **Offer and Ad Details**: `touchpoint_offer_type`, `bizible_ad_campaign_name`, `bizible_ad_content`, `bizible_ad_group_name`.\n*   **URL and UTM Information**: `bizible_form_url`, `bizible_landing_page`, `bizible_referrer_page`, and parsed UTM parameters (`utm_campaign`, `utm_source`, `utm_medium`, `utm_content`, etc.), including specialized UTM parsing for campaign details like `utm_campaign_date`, `utm_campaign_region`, etc.\n*   **Marketing Channel Groupings**: `bizible_marketing_channel`, `bizible_marketing_channel_path`, `marketing_review_channel_grouping`, `pipe_name`.\n*   **Influence Flags**: `is_dg_influenced`, `is_dg_sourced`.\n*   **Keystone Content Details**: `keystone_content_name`, `keystone_gitlab_epic`, `keystone_gtm`, `keystone_url_slug`, `keystone_type` from `prep_bizible_touchpoint_keystone`.\n*   **Source Data**: How this dimension is derived from `prep_crm_touchpoint` and `prep_crm_attribution_touchpoint`, along with `map_bizible_campaign_grouping` and `sheetload_devrel_influenced_campaigns_source` for enriched categorizations."
    },
    {
      "name": "### 3.6. [dim_date](chapter_360.md): Date Dimension",
      "content": "This chapter describes the `dim_date` table, a standard date dimension providing a comprehensive calendar for time-based analysis across all models. It includes a wide range of date-related attributes, from daily details to fiscal periods, enabling flexible and consistent time-series reporting.\n\nKey content includes:\n*   **Date Identifiers**: `date_id` (YYYYMMDD format).\n*   **Standard Date Attributes**: `date_actual`, `day_name`, `month_actual`, `year_actual`, `quarter_actual`, `day_of_week`, `week_of_year`, `day_of_month`, `day_of_quarter`, `day_of_year`.\n*   **Fiscal Calendar Attributes**: `fiscal_year`, `fiscal_quarter`, `day_of_fiscal_quarter`, `day_of_fiscal_year`, `fiscal_month_name`, `fiscal_quarter_name_fy`.\n*   **Period Boundaries**: `first_day_of_month`, `last_day_of_month`, `first_day_of_fiscal_quarter`, `last_day_of_fiscal_quarter`, etc.\n*   **Time-to-Date Flags**: `is_fiscal_month_to_date`, `is_fiscal_quarter_to_date`, `is_fiscal_year_to_date`.\n*   **Source Data**: Its derivation from `prep_date`, which builds the date spine from raw date details."
    },
    {
      "name": "### 3.7. [dim_sales_segment](chapter_370.md): Sales Segment Dimension",
      "content": "This chapter details the `dim_sales_segment` table, a straightforward dimension used to categorize and group sales segments. It ensures consistent naming and grouping of sales territories across various analytical models.\n\nKey content includes:\n*   **Segment Identifiers**: `dim_sales_segment_id`.\n*   **Segment Names**: `sales_segment_name`, `sales_segment_grouped`.\n*   **Purpose**: Explain its role in enabling consistent segmentation and aggregation of sales data.\n*   **Source Data**: Its derivation from `prep_sales_segment`, which extracts and standardizes sales segment names from account data."
    },
    {
      "name": "## 4. Fact Models",
      "content": "This section outlines the fact models, which contain the quantitative, measurable data points used for analytical calculations and performance tracking. These tables are designed to store metrics at the lowest grain, allowing for flexible aggregation across various dimensions."
    },
    {
      "name": "### 4.1. [fct_crm_touchpoint](chapter_410.md): CRM Touchpoint Fact",
      "content": "This chapter describes the `fct_crm_touchpoint` table, which captures the measurable outcomes associated with individual CRM touchpoints. It primarily focuses on attribution counts that quantify the influence of each touchpoint.\n\nKey content includes:\n*   **Touchpoint Identifiers**: `dim_crm_touchpoint_id`.\n*   **Associated IDs**: `bizible_person_id` (from source), `dim_crm_person_id` (from [dim_crm_person](chapter_310.md)), `dim_crm_user_id` (from [dim_crm_user](chapter_330.md)), `dim_campaign_id` (from [dim_campaign](chapter_340.md)), `dim_crm_account_id` (from [dim_crm_account](chapter_320.md)), and related parent/sales segment IDs from `map_crm_account`.\n*   **Attribution Counts**: `bizible_count_first_touch`, `bizible_count_lead_creation_touch`, `bizible_count_u_shaped`.\n*   **Dates**: `bizible_created_date`.\n*   **Source Data**: Its derivation from `prep_crm_touchpoint` and linkages to `map_crm_account` and `prep_crm_person` for dimension foreign keys."
    },
    {
      "name": "### 4.2. [fct_crm_person](chapter_420.md): CRM Person Fact",
      "content": "This chapter details the `fct_crm_person` table, which focuses on key dates and factual metrics related to a person's progression through the CRM lifecycle. It provides a chronological view of critical milestones for each lead or contact.\n\nKey content includes:\n*   **Person Identifiers**: `dim_crm_person_id`, `sfdc_record_id`.\n*   **Key Lifecycle Dates**: `created_date`, `inquiry_date`, `true_inquiry_date`, `mql_date_first`, `mql_date_latest`, `accepted_date`, `qualified_date`, `converted_date`.\n*   **Flags and Counts**: `is_mql`, `is_inquiry`, `mql_count`, `is_bdr_sdr_worked`, `is_abm_tier_inquiry`, `is_abm_tier_mql`.\n*   **Attribution and Engagement**: `last_utm_content`, `last_utm_campaign`, `groove_active_flows_count`, `person_score`.\n*   **Joining Logic**: How it combines data from `prep_crm_person`, `sfdc_leads`, `sfdc_contacts`, `marketing_qualified_leads` (internal CTEs), and various mapping tables like `map_crm_account` and `prep_crm_user_hierarchy` for establishing dimensional relationships and deriving facts."
    },
    {
      "name": "### 4.3. [fct_campaign](chapter_430.md): Campaign Fact",
      "content": "This chapter describes the `fct_campaign` table, which aggregates measurable outcomes and financial data related to marketing campaigns. It is primarily used for assessing campaign performance, budget utilization, and impact on the sales funnel.\n\nKey content includes:\n*   **Campaign Identifiers**: `dim_campaign_id`, `dim_parent_campaign_id`.\n*   **Related User IDs**: `campaign_owner_id`, `created_by_id`, `last_modified_by_id`.\n*   **Dates and Date IDs**: `start_date`, `end_date`, `created_date`, `last_modified_date`, `last_activity_date` (and their respective `_id` counterparts for joining with [dim_date](chapter_360.md)).\n*   **Geographic Data**: `region`, `sub_region`.\n*   **Planned Values**: `planned_inquiry`, `planned_mql`, `planned_pipeline`, `planned_sao`, `planned_won`, `planned_roi`, `total_planned_mql`.\n*   **Actual Costs and Revenues**: `budgeted_cost`, `expected_response`, `expected_revenue`, `actual_cost`, `amount_all_opportunities`, `amount_won_opportunities`.\n*   **Counts**: `count_contacts`, `count_converted_leads`, `count_leads`, `count_opportunities`, `count_responses`, `count_won_opportunities`, `count_sent`.\n*   **Source Data**: Its derivation from `prep_campaign`, which provides the raw campaign metrics and attributes."
    },
    {
      "name": "## 5. Preparatory Data Models",
      "content": "This section details the preparatory (`prep_`) models, which are intermediate tables responsible for cleaning, transforming, and structuring raw data from various source systems. These models are crucial for ensuring data quality, consistency, and a normalized structure before populating the final dimension and fact tables."
    },
    {
      "name": "### 5.1. CRM Source Preparation",
      "content": "This sub-section covers models specifically designed to prepare data originating from Salesforce (SFDC) and related CRM activities."
    },
    {
      "name": "#### 5.1.1. `prep_crm_user` & `prep_crm_user_daily_snapshot`",
      "content": "These models prepare current and historical snapshot data for CRM users from Salesforce. They standardize user profiles, roles, and organizational hierarchies.\n\nKey aspects:\n*   Extracts raw user data (`sfdc_users_source`, `sfdc_user_roles_source`, `sheetload_mapping_sdr_sfdc_bamboohr_source`).\n*   Defines user attributes like `user_name`, `title`, `department`, `team`, `is_active`.\n*   Structures sales hierarchy fields: `crm_user_sales_segment`, `crm_user_geo`, `crm_user_region`, `crm_user_area`, `crm_user_business_unit`.\n*   Creates `dim_crm_user_hierarchy_sk` for historical user hierarchy tracking.\n*   `prep_crm_user_daily_snapshot` captures daily states of user information, allowing for point-in-time analysis of user attributes."
    },
    {
      "name": "#### 5.1.2. `prep_crm_person`",
      "content": "This model prepares a unified view of persons (leads and contacts) from Salesforce and Marketo, enriching them with Bizible touchpoint information and other relevant attributes.\n\nKey aspects:\n*   Combines `sfdc_contacts` and `sfdc_leads` with `biz_person_with_touchpoints` (from Bizible) and `marketo_persons`.\n*   Standardizes person attributes: `email_hash`, `email_domain`, `title`, `country`, `lead_source`, `status`, `person_score`.\n*   Derives key lifecycle dates: `created_date`, `inquiry_date`, `mql_date_first`.\n*   Integrates data from `crm_activity` (tasks/events) and `sfdc_account_source` (6 Sense segments).\n*   Adds `dim_account_demographics_hierarchy_sk` for linking to account hierarchies at time of creation.\n*   Enriches with MQL and most recent touchpoint details from `prep_bizible_touchpoint_information`."
    },
    {
      "name": "#### 5.1.3. `prep_crm_account` & `prep_crm_account_daily_snapshot`",
      "content": "These models prepare current and historical snapshot data for CRM accounts, incorporating various firmographic, sales, and behavioral attributes.\n\nKey aspects:\n*   Processes raw account data from `sfdc_account_source` and `sfdc_account_snapshots_source`.\n*   Enriches with information from `map_merged_crm_account` (for merged accounts), `pte_scores`, `ptc_scores` (data science scores).\n*   Standardizes account demographics: `account_sales_segment`, `account_geo`, `account_region`, `account_area`, `account_business_unit`, `account_employee_count_band`.\n*   Includes various flags for strategic accounts, resellers, and tech stack presence (from `zi_technologies`).\n*   `prep_crm_account_daily_snapshot` specifically captures the daily state of account information, crucial for point-in-time reporting and historical analysis of account attributes."
    },
    {
      "name": "#### 5.1.4. `prep_crm_opportunity`",
      "content": "This model prepares detailed opportunity data, including sales-related metrics, stage progression, and associated entities. It's a complex model integrating various aspects of the sales funnel.\n\nKey aspects:\n*   Combines live `sfdc_opportunity_source_v1` with historical `sfdc_opportunity_snapshots_source_v1`.\n*   Calculates `net_arr` based on `raw_net_arr` and various ratios, accounting for different deal types and historical data nuances.\n*   Integrates `sfdc_opportunity_stage_source` for stage definitions and `net_iacv_to_net_arr_ratio` for financial conversions.\n*   Enriches with account, user, and partner information from their respective `prep_` and `snapshot` models ([prep_crm_account_daily_snapshot](chapter_513.md), [prep_crm_user_daily_snapshot](chapter_511.md), etc.).\n*   Derives important flags like `is_booked_net_arr`, `is_net_arr_pipeline_created`, `is_win_rate_calc`, `is_sao`.\n*   Includes partner details, deal paths, and various calculated metrics like `cycle_time_in_days` and `deal_size`."
    },
    {
      "name": "#### 5.1.5. `prep_crm_task` & `prep_crm_event`",
      "content": "These models prepare data related to sales and customer success activities recorded in Salesforce as tasks and events. They standardize activity details and link them to relevant CRM entities.\n\nKey aspects of `prep_crm_task`:\n*   Processes `sfdc_task_source` to extract task details like `task_subject`, `task_status`, `task_type`, `comments`, `call_type`, `call_disposition`, `call_duration_in_seconds`.\n*   Links tasks to `account_id`, `owner_id`, `lead_or_contact_id`, `opportunity_id`.\n*   Derives flags such as `is_reminder_task`, `is_completed_task`, `is_demand_gen_task`, `is_meeting_task`, `is_email_task`, `is_call_task`.\n\nKey aspects of `prep_crm_event`:\n*   Processes `sfdc_event_source` to extract event details like `event_subject`, `event_type`, `event_disposition`, `event_start_date_time`, `event_end_date_time`.\n*   Links events to `account_id`, `owner_id`, `lead_or_contact_id`, `opportunity_id`.\n*   Includes flags for event characteristics like `is_all_day_event`, `is_meeting_canceled`.\n*   Both models are used to determine `min_task_completed_date_by_bdr_sdr` in `prep_crm_person` for `is_bdr_sdr_worked` flag."
    },
    {
      "name": "### 5.2. Marketing & Sales Tool Integrations Preparation",
      "content": "This sub-section focuses on models that prepare data from marketing automation and sales enablement tools, primarily Bizible, enriching it for attribution and channel analysis."
    },
    {
      "name": "#### 5.2.1. `prep_bizible_touchpoint` & `prep_crm_attribution_touchpoint`",
      "content": "These models are responsible for preparing the raw touchpoint data from Bizible, standardizing URLs, categorizing touchpoint types, and enriching with additional context.\n\nKey aspects:\n*   Processes `sfdc_bizible_touchpoint_source` and `sfdc_bizible_attribution_touchpoint_source`.\n*   Cleans `bizible_form_url` and `bizible_landing_page` for consistent mapping.\n*   Categorizes `touchpoint_offer_type_wip` and `touchpoint_offer_type_grouped` based on URL patterns, campaign types (from `prep_campaign`), and PathFactory mappings (`sheetload_bizible_to_pathfactory_mapping`).\n*   `prep_crm_attribution_touchpoint` specifically handles attribution touchpoints, while `prep_bizible_touchpoint` handles all recorded touchpoints."
    },
    {
      "name": "#### 5.2.2. `prep_bizible_touchpoint_keystone` & `prep_bizible_marketing_channel_path`",
      "content": "These models provide further enrichment and standardization for Bizible data, linking touchpoints to specific content initiatives and defining marketing channel hierarchies.\n\nKey aspects of `prep_bizible_touchpoint_keystone`:\n*   Joins `prep_crm_unioned_touchpoint` (a union of regular and attribution touchpoints) with `gitlab_data_yaml.content_keystone_source`.\n*   Enriches touchpoints with `keystone_content_name`, `gitlab_epic`, `gtm`, `type`, and `url_slug` based on matching URLs or campaign names.\n\nKey aspects of `prep_bizible_marketing_channel_path`:\n*   Standardizes `bizible_marketing_channel_path_name_grouped` from `map_bizible_marketing_channel_path`.\n*   Provides a lookup for clean and grouped marketing channel path names, useful for consistent reporting and analysis of channel performance."
    },
    {
      "name": "#### 5.2.3. `prep_campaign`",
      "content": "This model prepares detailed campaign information from Salesforce, ensuring consistency and enriching the data with parent-child relationships and calculated fields.\n\nKey aspects:\n*   Processes `sfdc_campaign_source`.\n*   Standardizes campaign attributes: `campaign_name`, `status`, `type`, `description`, `budget_holder`, `region`, `sub_region`.\n*   Establishes `dim_parent_campaign_id` and derives `series_campaign_id` and `series_campaign_name` to group related campaigns.\n*   Includes planned and actual financial metrics (`budgeted_cost`, `expected_revenue`, `actual_cost`) and various counts (`count_leads`, `count_opportunities`)."
    },
    {
      "name": "### 5.3. Financial & Reference Data Preparation",
      "content": "This sub-section includes models that prepare financial data from Zuora and various lookup/reference data tables for use across the CRM data model."
    },
    {
      "name": "#### 5.3.1. `prep_charge_mrr`",
      "content": "This model prepares Monthly Recurring Revenue (MRR) data from Zuora charges, specifically tailored for account cohort analysis and financial reporting.\n\nKey aspects:\n*   Processes data from `prep_charge` (which itself processes raw Zuora charge and subscription data) and `prep_date`.\n*   Focuses on recurring charges (`charge_type = 'Recurring'`) and includes `mrr` and `arr` calculations.\n*   Derives `previous_mrr` and `delta_mrr` for understanding changes in recurring revenue over time.\n*   Includes `is_paid_in_full` and `months_of_future_billings` for financial forecasting."
    },
    {
      "name": "#### 5.3.2. `prep_date`",
      "content": "This foundational model generates a comprehensive date spine, providing all necessary date-related attributes for time-based analysis across the entire data warehouse. It is derived from a core date details source.\n\nKey aspects:\n*   Generates a continuous sequence of dates.\n*   Calculates standard date components: year, quarter, month, day of week, week of year.\n*   Derives fiscal calendar components: `fiscal_year`, `fiscal_quarter`, `fiscal_month_name`, and related flags and normalized values.\n*   Provides attributes for `is_holiday`, `days_in_month_count`, and `days_until_last_day_of_month`."
    },
    {
      "name": "#### 5.3.3. `prep_sales_funnel_target`",
      "content": "This model prepares sales funnel target data, often loaded from external flat files (sheetloads), to allow for performance tracking against planned goals.\n\nKey aspects:\n*   Processes `sheetload_sales_targets_source`.\n*   Includes `kpi_name`, `month`, `sales_qualified_source`, `order_type`, and `allocated_target`.\n*   Maps sales hierarchy elements like `user_segment`, `user_geo`, `user_region`, `user_area`, `user_business_unit`, and `user_role_name` to targets.\n*   Generates `dim_crm_user_hierarchy_sk` for consistent joining with actual performance data."
    },
    {
      "name": "#### 5.3.4. `prep_industry`, `prep_sales_territory`, `prep_location_country`, `prep_location_region`",
      "content": "These models are responsible for preparing and standardizing lookup values for various dimensions, ensuring consistent categorization and reporting.\n\nKey aspects:\n*   **`prep_industry`**: Extracts and standardizes industry names from account data (`prep_sfdc_account`).\n*   **`prep_sales_territory`**: Extracts and standardizes sales territory names from account data (`prep_sfdc_account`).\n*   **`prep_location_country`**: Enriches country information from `sheetload_maxmind_countries_source` and `zuora_country_geographic_region`, including ISO codes and continent information.\n*   **`prep_location_region`**: Extracts and standardizes geographic region names from user data (`sfdc_users_source`).\n*   These models provide distinct lists of values and their respective IDs for use in dimension tables."
    },
    {
      "name": "## 6. Mapping and Utility Models",
      "content": "This section describes auxiliary models that serve specific functions such as mapping IDs, handling data mergers, or providing static lookup tables. These models are essential for data integrity and usability across the warehouse."
    },
    {
      "name": "### 6.1. Mapping Models",
      "content": "These models are designed to resolve ambiguities, standardize identifiers, and facilitate joins between different parts of the data model."
    },
    {
      "name": "#### 6.1.1. `map_merged_crm_account`",
      "content": "This model addresses scenarios where CRM accounts are merged, ensuring that historical data points map to the current, active account ID.\n\nKey aspects:\n*   Identifies master records and merged accounts from `sfdc_account_source` and `sfdc_account_snapshots_source`.\n*   Uses a recursive CTE to trace merged account lineages and determine the `merged_account_id`.\n*   Flags `is_merged` and `deleted_not_merged` for data quality insights.\n*   Provides `dim_crm_account_id` for consistent mapping to the primary account dimension."
    },
    {
      "name": "#### 6.1.2. `map_crm_account`",
      "content": "This model provides a comprehensive mapping of CRM account IDs to various related dimension IDs, simplifying joins and ensuring proper dimensional relationships.\n\nKey aspects:\n*   Connects `prep_sfdc_account` with several `prep_` and `dim_` models ([prep_sales_segment](chapter_534.md), [prep_sales_territory](chapter_534.md), [prep_industry](chapter_534.md), [prep_location_country](chapter_534.md), [prep_location_region](chapter_534.md)).\n*   Generates foreign keys for parent sales segment, sales territory, industry, and account location dimensions based on account attributes."
    },
    {
      "name": "#### 6.1.3. `map_bizible_campaign_grouping` & `map_bizible_marketing_channel_path`",
      "content": "These models standardize and categorize Bizible data for consistent reporting of marketing channels and campaign groupings.\n\nKey aspects of `map_bizible_campaign_grouping`:\n*   Combines `sfdc_bizible_touchpoint_source` and `sfdc_bizible_attribution_touchpoint_source` with `prep_campaign`.\n*   Derives `bizible_integrated_campaign_grouping`, `gtm_motion`, and `touchpoint_segment` based on complex logic involving campaign IDs, UTMs, and landing page URLs.\n\nKey aspects of `map_bizible_marketing_channel_path`:\n*   Categorizes `bizible_marketing_channel_path` values into broader `bizible_marketing_channel_path_name_grouped` categories (e.g., 'Inbound Free Channels', 'Inbound Paid').\n*   Provides a standardized lookup for marketing channel paths."
    },
    {
      "name": "### 6.2. Utility & Seed Models",
      "content": "This sub-section lists other utility and seed models that provide reference data or specific calculation inputs to the larger data models."
    },
    {
      "name": "#### 6.2.1. `net_iacv_to_net_arr_ratio`",
      "content": "This model provides crucial ratios used for converting Incremental Annual Contract Value (IACV) to Net Annual Recurring Revenue (Net ARR), especially for forecasting and pipeline analysis.\n\nKey aspects:\n*   Sources `seed_sales.net_iacv_to_net_arr_ratio`.\n*   Provides `ratio_net_iacv_to_net_arr` segmented by `user_segment_stamped` and `order_type`.\n*   Used in [prep_crm_opportunity](chapter_514.md) for its `calculated_from_ratio_net_arr` field."
    },
    {
      "name": "#### 6.2.2. External Source Models",
      "content": "This sub-chapter acknowledges the various raw and seed tables directly imported from external systems or manually loaded, which form the base layer for all subsequent transformations. These models typically undergo minimal transformation and serve as the direct interface to the source systems.\n\nKey categories of external source models include:\n*   **Salesforce Raw Data**: e.g., `sfdc_lead_source`, `sfdc_contact_source`, `sfdc_account_source`, `sfdc_opportunity_source`, `sfdc_task_source`, `sfdc_event_source`, `sfdc_campaign_source`, Bizible sources, Zuora Quote sources.\n*   **Marketo Raw Data**: e.g., `marketo_lead_source`, Marketo activity logs.\n*   **Zuora Raw Data**: e.g., `zuora_account_source`, `zuora_subscription_source`, `zuora_rate_plan_charge_source`, `zuora_rate_plan_source`, Zuora Order API sources, Zuora Revenue sources.\n*   **Sheetload Data**: e.g., `sheetload_devrel_influenced_campaigns_source`, `sheetload_mapping_sdr_sfdc_bamboohr_source`, `sheetload_sales_targets_source`, `sheetload_maxmind_countries_source`.\n*   **Driveload Data**: e.g., `driveload_lam_corrections_source`.\n*   **Data Science Inputs**: e.g., `pte_scores_source`, `ptc_scores_source`.\n*   **GitLab Data YAML**: e.g., `gitlab_data_yaml.content_keystone_source`."
    }
  ]
}