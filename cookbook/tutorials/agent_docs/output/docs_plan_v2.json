{
  "table_of_contents": [
    {
      "name": "## 1. Overview of CRM Touchpoint Marketing Mart",
      "content": "This document provides a comprehensive overview of the `mart_crm_touchpoint` table, a central analytical mart designed for marketing and sales insights. It integrates data from various CRM, marketing automation, and sales systems to offer a unified view of customer touchpoints.\n\nThis mart is crucial for understanding the customer journey, campaign effectiveness, and the impact of marketing efforts on the sales pipeline. It combines detailed touchpoint information with person, campaign, account, and user attributes, enabling deep analysis of marketing influence and ROI.\n\nKey areas covered include the detailed structure of the mart table, its constituent dimension and fact tables, and the complex logic used to derive key marketing and sales metrics.\n\n**Diagram:** Illustrate the relationships between the core entities (`mart_crm_touchpoint`, `dim_crm_touchpoint`, `fct_crm_touchpoint`, `dim_crm_person`, `fct_crm_person`, `dim_campaign`, `fct_campaign`, `dim_crm_account`, `dim_crm_user`) and their primary data flows."
    },
    {
      "name": "### 1.1. Purpose and Scope",
      "content": "This section defines the primary purpose of the `mart_crm_touchpoint` table, which is to serve as a single source of truth for marketing touchpoint analysis. It outlines the scope of data included, focusing on marketing influence, lead conversion, and campaign performance."
    },
    {
      "name": "### 1.2. Data Integration Overview",
      "content": "A high-level explanation of how data from various source systems (e.g., Salesforce, Marketo, Zuora, internal tools) is integrated and transformed to populate the `mart_crm_touchpoint` table. Emphasize the layered approach using `prep` and `mapping` tables to ensure data quality and consistency."
    },
    {
      "name": "## 2. CRM Touchpoint Data",
      "content": "This chapter delves into the specifics of CRM touchpoint data, which captures interactions between potential or existing customers and marketing efforts."
    },
    {
      "name": "### 2.1. `dim_crm_touchpoint` (Dimension)",
      "content": "The `dim_crm_touchpoint` table stores descriptive attributes of individual marketing touchpoints.\n\n**Purpose:** To provide granular details about each interaction, such as where and when it occurred, and the marketing context.\n\n**Key Fields:**\n*   `dim_crm_touchpoint_id`: Unique identifier for each touchpoint.\n*   `bizible_touchpoint_date`, `bizible_touchpoint_date_time`, `bizible_touchpoint_month`: Date and time of the touchpoint.\n*   `bizible_touchpoint_position`: Position in the customer journey (e.g., First Touch, Lead Creation).\n*   `bizible_touchpoint_source`, `bizible_touchpoint_source_type`, `bizible_touchpoint_type`: Origin and nature of the touchpoint.\n*   `touchpoint_offer_type`, `touchpoint_offer_type_grouped`: Categorization of the content/offer.\n*   `bizible_ad_campaign_name`, `bizible_ad_content`, `bizible_ad_group_name`: Advertising campaign details.\n*   `bizible_form_url`, `bizible_landing_page`, `bizible_referrer_page`: URLs associated with the touchpoint.\n*   `utm_campaign`, `utm_source`, `utm_medium`, `utm_content`, `utm_budget`, `utm_allptnr`, `utm_partnerid`: Standard UTM parameters captured from URLs.\n\n**Derived Attributes & Logic:**\n*   **UTM Parsing:** Explanation of how UTM parameters are extracted from `bizible_landing_page_raw` and `bizible_form_url_raw` to populate fields like `utm_campaign_date`, `utm_campaign_region`, `utm_content_offer`, etc. (Refer to `prep_crm_touchpoint.md` and `prep_crm_attribution_touchpoint.md` for full details).\n*   **Channel Grouping:** How `marketing_review_channel_grouping` and `pipe_name` are derived based on `bizible_marketing_channel` and `bizible_marketing_channel_path` to standardize channel reporting.\n*   **Integrated Campaign Grouping:** Derivation of `integrated_campaign_grouping` and `bizible_integrated_campaign_grouping` (Refer to [map_bizible_campaign_grouping](2410.md)).\n*   `is_dg_influenced`, `is_dg_sourced`, `is_devrel_influenced_campaign`: Flags indicating influence types.\n*   `keystone_content_name`, `keystone_gitlab_epic`, `keystone_gtm`, `keystone_url_slug`, `keystone_type`: Enriched content information (Refer to `prep_bizible_touchpoint_keystone.md`)."
    },
    {
      "name": "### 2.2. `fct_crm_touchpoint` (Fact)",
      "content": "The `fct_crm_touchpoint` table contains measurable metrics and foreign keys linking to associated dimensions for each touchpoint.\n\n**Purpose:** To enable quantitative analysis of touchpoint effectiveness and attribution.\n\n**Key Fields:**\n*   `dim_crm_touchpoint_id`: Foreign key to [dim_crm_touchpoint](210.md).\n*   `dim_crm_person_id`: Foreign key to [dim_crm_person](220.md).\n*   `dim_campaign_id`: Foreign key to [dim_campaign](230.md).\n*   `dim_crm_account_id`: Foreign key to [dim_crm_account](240.md).\n*   `dim_crm_user_id`: Foreign key to [dim_crm_user](250.md).\n*   `bizible_count_first_touch`: Count for first touch attribution.\n*   `bizible_count_lead_creation_touch`: Count for lead creation touch attribution.\n*   `bizible_count_u_shaped`: Count for U-shaped attribution model."
    },
    {
      "name": "## 3. CRM Person Data",
      "content": "This chapter focuses on data related to individual persons (leads and contacts) within the CRM system."
    },
    {
      "name": "### 3.1. `dim_crm_person` (Dimension)",
      "content": "The `dim_crm_person` table stores comprehensive demographic and behavioral attributes of leads and contacts.\n\n**Purpose:** To provide a complete profile of individuals for segmentation and personalization.\n\n**Key Fields:**\n*   `dim_crm_person_id`: Unique identifier for each person.\n*   `sfdc_record_id`, `sfdc_record_type`: Salesforce ID and type (Lead/Contact).\n*   `email_hash`, `email_domain`, `is_valuable_signup`: Email-related information and quality flags.\n*   `marketo_lead_id`: Marketo Lead ID.\n*   `owner_id`, `dim_crm_user_id`: Sales owner information.\n*   `person_score`, `behavior_score`: Lead scoring metrics.\n*   `crm_person_title`, `crm_person_country`, `crm_person_state`, `crm_person_status`: Personal and geographic details.\n*   `lead_source`, `lead_source_type`, `source_buckets`, `net_new_source_categories`: Origin of the lead.\n*   `account_demographics_sales_segment`, `account_demographics_geo`, `account_demographics_region`, `account_demographics_area`: Associated account demographics stamped at key moments.\n*   `is_partner_recalled`: Flag for partner recall status.\n\n**Derived Attributes & Logic:**\n*   `is_valuable_signup`: Derived from `email_domain_type`.\n*   `person_first_country`: Standardized first country of the person (Refer to `prep_crm_person.md`).\n*   Six Sense and UserGems fields: External data integrations providing additional insights.\n*   Groove fields: Engagement metrics from Groove sales engagement platform.\n*   `bizible_mql_touchpoint_id`, `bizible_mql_touchpoint_date`, `bizible_most_recent_touchpoint_id`: Key touchpoint information related to MQL and most recent interactions (Refer to `prep_bizible_touchpoint_information.md`)."
    },
    {
      "name": "### 3.2. `fct_crm_person` (Fact)",
      "content": "The `fct_crm_person` table tracks key dates and lifecycle events for each person, along with related counts.\n\n**Purpose:** To enable analysis of person progression through the marketing and sales funnel.\n\n**Key Fields:**\n*   `dim_crm_person_id`: Foreign key to [dim_crm_person](310.md).\n*   `created_date`, `inquiry_date`, `mql_date_first`, `mql_date_latest`, `accepted_date`, `qualifying_date`, `qualified_date`, `converted_date`: Key lifecycle dates.\n*   `is_mql`, `is_inquiry`: Flags indicating MQL and inquiry status.\n*   `mql_count`: Total number of MQLs for a person.\n*   `last_utm_content`, `last_utm_campaign`: Last known UTMs for the person.\n\n**Derived Attributes & Logic:**\n*   `true_inquiry_date`: Earliest inferred inquiry date.\n*   `is_abm_tier_inquiry`, `is_abm_tier_mql`: Flags indicating if the person was an ABM tier inquiry/MQL at the time (Refer to [dim_crm_account.md](240.md) and associated snapshots)."
    },
    {
      "name": "## 4. Campaign Data",
      "content": "This chapter outlines the structure and content related to marketing campaigns."
    },
    {
      "name": "### 4.1. `dim_campaign` (Dimension)",
      "content": "The `dim_campaign` table holds descriptive attributes for each marketing campaign.\n\n**Purpose:** To categorize and describe marketing initiatives.\n\n**Key Fields:**\n*   `dim_campaign_id`: Unique identifier for the campaign.\n*   `campaign_name`: Name of the campaign.\n*   `is_active`, `status`, `type`: Operational status and classification of the campaign.\n*   `description`: Campaign description.\n*   `budget_holder`: Team responsible for the campaign budget.\n*   `bizible_touchpoint_enabled_setting`: Bizible integration setting.\n*   `strategic_marketing_contribution`, `large_bucket`, `reporting_type`: Strategic categorization.\n*   `allocadia_id`: Allocadia ID for financial tracking.\n*   `is_a_channel_partner_involved`, `is_an_alliance_partner_involved`, `is_this_an_in_person_event`, `will_there_be_mdf_funding`: Flags for partner and event involvement.\n*   `alliance_partner_name`, `channel_partner_name`: Names of involved partners.\n*   `sales_play`, `gtm_motion`: Alignment with sales and Go-To-Market strategies."
    },
    {
      "name": "### 4.2. `fct_campaign` (Fact)",
      "content": "The `fct_campaign` table contains quantitative metrics and date information for campaigns.\n\n**Purpose:** To track campaign performance and resource allocation.\n\n**Key Fields:**\n*   `dim_campaign_id`: Foreign key to [dim_campaign](410.md).\n*   `dim_parent_campaign_id`: Link to parent campaign if applicable.\n*   `campaign_owner_id`, `created_by_id`: User IDs for ownership and creation.\n*   `camapaign_start_date`, `campaign_end_date`, `campaign_created_date`, `campaign_last_modified_date`, `campaign_last_activity_date`: Important campaign dates.\n*   `campaign_region`, `campaign_sub_region`: Geographic focus of the campaign.\n*   `budgeted_cost`, `actual_cost`: Financial tracking of campaign spend.\n*   `expected_response`, `expected_revenue`: Projected outcomes.\n*   `amount_all_opportunities`, `amount_won_opportunities`: Revenue generated.\n*   `count_contacts`, `count_converted_leads`, `count_leads`, `count_opportunities`, `count_responses`, `count_won_opportunities`, `count_sent`: Counts of various campaign outcomes.\n*   `planned_inquiry`, `planned_mql`, `planned_pipeline`, `planned_sao`, `planned_won`, `planned_roi`, `total_planned_mql`: Planned targets for marketing funnel stages."
    },
    {
      "name": "## 5. CRM Account Data",
      "content": "This chapter describes the data related to customer and prospect accounts."
    },
    {
      "name": "### 5.1. `dim_crm_account` (Dimension)",
      "content": "The `dim_crm_account` table provides a comprehensive view of accounts, including their demographics, health, and strategic classifications.\n\n**Purpose:** To enable account-level analysis and segmentation for marketing and sales efforts.\n\n**Key Fields:**\n*   `dim_crm_account_id`: Unique identifier for the account.\n*   `crm_account_name`: Name of the account.\n*   `crm_account_billing_country`, `crm_account_industry`, `crm_account_gtm_strategy`: Demographic and strategic attributes.\n*   `crm_account_focus_account`: Flag indicating if it's a focus account.\n*   `health_number`, `health_score_color`: Account health metrics.\n*   `dim_parent_crm_account_id`, `parent_crm_account_name`, `parent_crm_account_sales_segment`: Hierarchy and attributes of the parent account.\n*   `crm_account_owner_user_segment`: Sales segment of the account owner.\n*   `record_type_id`: Salesforce record type ID for the account.\n*   `gitlab_com_user`: Flag for GitLab.com users.\n*   `crm_account_type`: Type of CRM account.\n*   `technical_account_manager`: Name of the Technical Account Manager.\n*   `merged_to_account_id`: ID of the account it was merged into.\n*   `is_reseller`, `is_focus_partner`: Flags indicating partner status.\n\n**Derived Attributes & Logic:**\n*   **Employee Count Band:** `crm_account_employee_count_band` categorizes accounts by employee size.\n*   **ZoomInfo Technologies:** Flags like `is_zi_jenkins_present`, `is_zi_svn_present`, etc., derived from the `crm_account_zi_technologies` field, indicating the presence of specific technologies.\n*   **6Sense Fields:** Includes various 6Sense scores and dates related to account intelligence.\n*   **Qualified Fields:** Contains metrics from Qualified.com such as `qualified_score`, `qualified_condition`, and session/visitor counts.\n*   **PTE/PTC Scores:** `pte_score`, `pte_decile`, `pte_score_group`, `ptc_score`, `ptc_decile`, `ptc_score_group` from data science models (Refer to `pte_scores_source.md` and `ptc_scores_source.md`).\n*   **Account Cohort Dates:** `crm_account_arr_cohort_month` and `crm_account_arr_cohort_quarter` derived from [prep_charge_mrr.md](1510.md)."
    },
    {
      "name": "## 6. CRM User Data",
      "content": "This chapter details information about CRM users, including sales representatives and campaign owners."
    },
    {
      "name": "### 6.1. `dim_crm_user` (Dimension)",
      "content": "The `dim_crm_user` table contains descriptive attributes for each CRM user.\n\n**Purpose:** To provide context about the individuals responsible for various CRM and marketing activities.\n\n**Key Fields:**\n*   `dim_crm_user_id`: Unique identifier for the user.\n*   `employee_number`: Employee ID.\n*   `user_name`, `title`, `department`, `team`: Basic user information.\n*   `manager_id`, `manager_name`: Managerial hierarchy.\n*   `user_email`: User's email address.\n*   `is_active`: User's active status.\n*   `start_date`, `ramping_quota`, `user_timezone`: Employment details.\n*   `user_role_id`, `user_role_name`, `user_role_type`: Salesforce role information.\n*   `user_role_level_1` to `user_role_level_5`: Hierarchical role levels.\n*   `crm_user_sales_segment`, `crm_user_geo`, `crm_user_region`, `crm_user_area`, `crm_user_business_unit`: Sales organizational attributes.\n\n**Derived Attributes & Logic:**\n*   `crm_user_sales_segment_grouped`: Grouped sales segment (e.g., 'Large' for 'Large' and 'PubSec').\n*   `crm_user_sales_segment_geo_region_area`: Concatenated field for full sales hierarchy.\n*   `sdr_sales_segment`, `sdr_region`: SDR specific segmentation (Refer to `sheetload_mapping_sdr_sfdc_bamboohr_source.md`).\n*   `crm_user_sub_business_unit`, `crm_user_division`, `asm`: Further hierarchical segmentation for sales (X-Ray hierarchy), derived from business unit, segment, geo, and role types (Refer to `prep_crm_user.md`)."
    },
    {
      "name": "## 7. Derived Metrics and Logic in `mart_crm_touchpoint`",
      "content": "This chapter details the complex business logic and derived metrics calculated within the `mart_crm_touchpoint` table, which are essential for advanced marketing and sales analytics."
    },
    {
      "name": "### 7.1. Influenced and Sourced Flags",
      "content": "These flags indicate the nature of marketing influence for each touchpoint.\n\n*   `is_fmm_influenced`: Identifies if a touchpoint was influenced by Field Marketing Managers (FMM). The logic considers `dim_campaign.budget_holder` ('fmm'), `campaign_owner.user_role_name` ('Field Marketing Manager'), `LOWER(dim_crm_touchpoint.utm_content)` containing '%field%', or `LOWER(dim_campaign.type)` = 'field event', or `LOWER(dim_crm_person.lead_source)` = 'field event'.\n\n*   `is_fmm_sourced`: Marks a touchpoint as sourced by FMM if `bizible_touchpoint_position` is 'FT' (First Touch) AND `is_fmm_influenced` is true.\n\n*   Similar logic applies to `is_dg_influenced` and `is_dg_sourced` (Demand Gen influenced/sourced), derived from `touchpoint_segment` (from [map_bizible_campaign_grouping](2410.md))."
    },
    {
      "name": "### 7.2. Integrated Budget Holder Categorization",
      "content": "The `integrated_budget_holder` field categorizes the primary budget owner for a touchpoint, harmonizing data from various sources:\n\n*   Prioritizes `dim_campaign.budget_holder` (e.g., 'fmm', 'dmp', 'corp', 'abm', 'cmp', 'devrel', 'cmty', 'ptnr', 'chnl').\n*   Falls back to `dim_crm_touchpoint.utm_budget` if `campaign.budget_holder` is not available.\n*   Further falls back to `dim_crm_touchpoint.bizible_ad_campaign_name` (e.g., '%abm%', '%pmg%', '%fmm%').\n*   Considers `dim_crm_touchpoint.utm_medium` (e.g., 'paidsocial', 'cpc').\n*   Finally, uses `campaign_owner.user_role_name` (e.g., '%field marketing%', '%abm%')."
    },
    {
      "name": "### 7.3. Funnel Stage Counts",
      "content": "These count fields track key conversions in the marketing and sales funnel based on touchpoint and person lifecycle dates:\n\n*   `count_inquiry`: 1 if `bizible_touchpoint_position` is 'LC' (Lead Creation) and not 'PostLC'.\n*   `count_true_inquiry`: 1 if `fct_crm_person.true_inquiry_date` is on or after `bizible_touchpoint_date`.\n*   `count_mql`: 1 if `fct_crm_person.mql_date_first` is on or after `bizible_touchpoint_date`.\n*   `count_net_new_mql`: The `bizible_count_lead_creation_touch` if `count_mql` is 1, else 0.\n*   `count_accepted`: 1 if `fct_crm_person.accepted_date` is on or after `bizible_touchpoint_date`.\n*   `count_net_new_accepted`: The `bizible_count_lead_creation_touch` if `count_accepted` is 1, else 0."
    },
    {
      "name": "### 7.4. MQL Weighting (`pre_mql_weight`)",
      "content": "The `pre_mql_weight` field is a fractional attribution value assigned to touchpoints that occurred *before* a person's first MQL date. This helps distribute credit for pre-MQL influence evenly among relevant touchpoints.\n\n*   **Logic:** For each person (`email_hash`) who became an MQL, all touchpoints occurring on or before their `mql_date_first` are identified. The `pre_mql_weight` for each of these touchpoints is calculated as `1 / [total number of pre-MQL touches for that person]`.\n*   Touchpoints occurring after `mql_date_first` or for persons who never MQL have a `pre_mql_weight` of 0. This calculation is performed using the `count_of_pre_mql_tps` and `pre_mql_tps_by_person` CTEs."
    },
    {
      "name": "## 8. Data Lineage and Transformation Layer",
      "content": "This chapter provides an overview of the data sources and the intermediate transformation layers that feed into the `mart_crm_touchpoint`."
    },
    {
      "name": "### 8.1. Overview of Prep Layer",
      "content": "The `PROD.common_prep` and `PROD.restricted_safe_common_prep` schemas contain prepared, cleaned, and standardized data from raw sources before it's used to build the dimension and fact tables.\n\n*   **Purpose:** To abstract raw source complexities, enforce data quality rules, resolve ambiguities (e.g., merging duplicate records), and enrich data with preliminary calculations or lookups.\n*   **Examples:** `prep_crm_person.sql` (enriches SFDC person data with Bizible and CRM activity), `prep_campaign.sql` (cleans and standardizes campaign attributes), `prep_crm_touchpoint.sql` (categorizes touchpoint types from raw URLs)."
    },
    {
      "name": "### 8.2. Mapping and Supporting Tables",
      "content": "The `PROD.common_mapping` and `PROD.restricted_safe_common_mapping` schemas house tables that provide critical lookup and mapping functionalities.\n\n*   **Purpose:** To standardize categorical data, resolve hierarchical relationships, and enable consistent joining across different source systems.\n*   **Examples:** [map_bizible_campaign_grouping](2410.md) (assigns integrated campaign categories to touchpoints), [map_crm_account](2420.md) (maps accounts to their sales segments, territories, etc.), [dim_date](100.md) (provides date-related attributes for time-series analysis)."
    },
    {
      "name": "### 8.3. Source Systems",
      "content": "The `mart_crm_touchpoint` and its upstream `prep` tables draw data from a variety of source systems, primarily residing in the `PREP` and `RAW` schemas.\n\n*   **Salesforce (SFDC):** Core CRM data including leads, contacts, accounts, opportunities, campaigns, users, tasks, events, and Bizible touchpoints (e.g., `sfdc_lead_source.md`, `sfdc_contact_source.md`, `sfdc_account_source.md`, `sfdc_campaign_source.md`).\n*   **Marketo:** Marketing automation data, especially for lead details and activities (e.g., `marketo_lead_source.md`).\n*   **Zuora:** Billing and subscription data, used for account cohorts and ARR calculations (e.g., `zuora_account_source.md`, `zuora_subscription_source.md`, `zuora_rate_plan_charge_source.md`).\n*   **Internal Spreadsheets/YAMLs:** Supplemental data such as DevRel influenced campaigns (`sheetload_devrel_influenced_campaigns_source.md`), SDR mappings (`sheetload_mapping_sdr_sfdc_bamboohr_source.md`), and Keystone content definitions (`content_keystone_source.md`).\n*   **Data Science Models:** Provides predictive scores and classifications (e.g., `pte_scores_source.md`, `ptc_scores_source.md`).\n*   **Snapshots:** Historical data from key Salesforce objects for time-based analysis (e.g., `sfdc_account_snapshots_source.md`, `sfdc_user_snapshots_source.md`, `sfdc_opportunity_snapshots_source.md`)."
    }
  ]
}