{
  "overview": "This document provides a comprehensive overview of the data transformations and table creation processes for several key tables within the PROD environment, focusing on marketing and CRM data. It details the source tables, transformation logic, and target table schemas for the following:\n\n*   `PROD.common_mart_marketing.mart_crm_touchpoint`\n*   `PROD.common.dim_crm_user`\n*   `PROD.common.dim_crm_person`\n*   `PROD.restricted_safe_common.dim_crm_account`\n*   `PROD.common.dim_campaign`\n*   `PROD.common.dim_crm_touchpoint`\n*   `PROD.common.fct_campaign`\n*   `PROD.common.fct_crm_person`\n*   `PROD.common.fct_crm_touchpoint`\n*   `PROD.common.dim_sales_segment`\n*   `PROD.common_prep.prep_crm_attribution_touchpoint`\n*   `PROD.common_prep.prep_date`\n*   `PROD.common_prep.prep_crm_user_hierarchy`\n*   `PROD.common_prep.prep_crm_user`\n*   `PROD.common_prep.prep_campaign`\n*   `PROD.common_prep.prep_crm_person`\n*   `PROD.common_prep.prep_crm_touchpoint`\n*   `PROD.common_prep.prep_bizible_marketing_channel_path`\n*   `PROD.common_prep.prep_sales_territory`\n*   `PROD.common_prep.prep_bizible_touchpoint_keystone`\n*   `PROD.common_prep.prep_industry`\n*   `PROD.restricted_safe_common_prep.prep_crm_account`\n*   `PROD.restricted_safe_common_prep.prep_charge_mrr`\n*   `PREP.sfdc.sfdc_lead_source`\n*   `PREP.sfdc.sfdc_contact_source`\n*   `PREP.sfdc.sfdc_bizible_touchpoint_source`\n*   `PREP.sheetload.sheetload_devrel_influenced_campaigns_source`\n*   `PROD.legacy.sfdc_account_snapshots_source`\n*   `PROD.common_mapping.map_bizible_campaign_grouping`\n*   `PROD.common_mapping.map_bizible_marketing_channel_path`\n*   `PROD.restricted_safe_common_mapping.map_crm_account`\n*   `PROD.common.dim_date`\n*   `PROD.common_prep.prep_location_country`\n*   `PROD.common_prep.prep_bizible_touchpoint_information`\n*   `PROD.common_prep.prep_crm_task`\n*   `PROD.common_prep.prep_crm_event`\n*   `PROD.common_mapping.map_bizible_marketing_channel_path`\n*   `PROD.common_mapping.map_sales_territory`\n*   `PROD.restricted_safe_common_prep.prep_sfdc_account`\n*   `PREP.data_science.ptc_scores_source`\n*   `PREP.data_science.pte_scores_source`\n*   `PREP.sfdc.sfdc_bizible_touchpoint_source`\n*   `PREP.sfdc.sfdc_users_source`\n*   `PREP.sfdc.sfdc_campaign_source`\n*   `PREP.sfdc.sfdc_account_source`\n*   `PREP.sfdc.sfdc_user_roles_source`\n*   `PROD.legacy.sfdc_user_snapshots_source`\n*   `PREP.sheetload.sheetload_mapping_sdr_sfdc_bamboohr_source`\n*   `PREP.sfdc.sfdc_bizible_attribution_touchpoint_source`\n*   `PREP.marketo.marketo_lead_source`\n*   `PREP.marketo.marketo_activity_delete_lead_source`\n*   `PREP.gitlab_data_yaml.content_keystone_source`\n*   `PREP.sheetload.sheetload_mapping_sdr_sfdc_bamboohr_source`\n*   `PREP.sfdc.sfdc_account_source`\n*   `PREP.sfdc.sfdc_user_roles_source`\n*   `PREP.sheetload.sheetload_devrel_influenced_campaigns_source`\n*   `PROD.legacy.sfdc_account_snapshots_source`\n*   `PREP.sfdc.sfdc_opportunity_source`\n*   `PREP.sfdc.sfdc_opportunity_stage_source`\n*   `PREP.sfdc.sfdc_record_type_source`\n*   `PREP.sfdc.sfdc_zqu_quote_source`\n*   `PROD.restricted_safe_legacy.sfdc_opportunity_snapshots_source`\n*   `PREP.common.dim_date`\n*   `PREP.common_prep.prep_location_region`\n*   `PREP.zuora_order.zuora_order_action_source`\n*   `PREP.zuora_order.zuora_order_source`\n*   `PREP.zuora.zuora_rate_plan_charge_source`\n*   `PREP.zuora.zuora_account_source`\n*   `PREP.zuora.zuora_subscription_source`\n*   `PREP.zuora.zuora_booking_transaction_source`\n*   `PREP.zuora_query_api.zuora_query_api_order_action_rate_plan_source`\n*   `PREP.zuora_query_api.zuora_query_api_charge_contractual_value_source`\n*   `PREP.zuora_revenue.zuora_revenue_manual_journal_entry_source`\n*   `PREP.zuora_revenue.zuora_revenue_revenue_contract_line_source`\n*   `PREP.sheetload.sheetload_sales_targets_source`\n*   `PREP.sheetload.sheetload_maxmind_countries_source`\n*   `PREP.sheetload.sheetload_bizible_to_pathfactory_mapping_source`",
  "chapters": [
    {
      "name": "## Chapter 1. Mart CRM Touchpoint Table",
      "content": "Details the creation of the `mart_crm_touchpoint` table, including:\n\n*   Purpose of the table\n*   Source tables: `dim_crm_touchpoint`, `fct_crm_touchpoint`, `dim_campaign`, `fct_campaign`, `dim_crm_person`, `fct_crm_person`, `dim_crm_account`, `dim_crm_user`\n*   Joining logic and data transformations\n*   Key calculated fields: `touchpoint_person_campaign_date_id`, `is_fmm_influenced`, `is_fmm_sourced`, `integrated_budget_holder`, `count_inquiry`, `count_true_inquiry`, `count_mql`, `count_net_new_mql`, `count_accepted`, `count_net_new_accepted`, `mql_crm_person_id`, `pre_mql_weight`\n*   Final selection and table schema"
    },
    {
      "name": "## Chapter 2. Dimension Tables",
      "content": "Details the creation of various dimension tables:\n\n*   Common elements: source tables, data transformations, final selection, table schema\n*   **2.1. dim_crm_user**\n    *   Source: `prep_crm_user`\n    *   Key fields: `dim_crm_user_id`, `user_name`, `title`, `team`, `is_active`, `user_role_name`, `crm_user_sales_segment`, `crm_user_geo`, `crm_user_region`\n*   **2.2. dim_crm_person**\n    *   Source: `prep_crm_person`\n    *   Key fields: `dim_crm_person_id`, `sfdc_record_id`, `sfdc_record_type`, `email_hash`, `lead_source`, `account_demographics_sales_segment`, `account_demographics_geo`, `is_partner_recalled`\n*   **2.3. dim_crm_account**\n    *   Source: `prep_crm_account`, `prep_charge_mrr`, `prep_date`\n    *   Key fields: `dim_crm_account_id`, `crm_account_name`, `crm_account_gtm_strategy`, `crm_account_billing_country`, `crm_account_industry`, `parent_crm_account_name`, `health_number`, `health_score_color`\n*   **2.4. dim_campaign**\n    *   Source: `prep_campaign`\n    *   Key fields: `dim_campaign_id`, `campaign_name`, `is_active`, `status`, `type`, `budget_holder`, `strategic_marketing_contribution`\n*   **2.5. dim_crm_touchpoint**\n    *   Source: `prep_crm_touchpoint`, `prep_campaign`, `prep_bizible_touchpoint_keystone`, `map_bizible_campaign_grouping`, `sheetload_devrel_influenced_campaigns_source`\n    *   Key fields: `dim_crm_touchpoint_id`, `bizible_touchpoint_date`, `bizible_touchpoint_source`, `bizible_touchpoint_type`, `utm_campaign`, `bizible_marketing_channel`, `bizible_marketing_channel_path`, `integrated_campaign_grouping`, `is_dg_influenced`, `is_dg_sourced`\n*   **2.6. dim_sales_segment**\n    *   Source: `prep_sales_segment`\n    *   Key fields: `dim_sales_segment_id`, `sales_segment_name`, `sales_segment_grouped`"
    },
    {
      "name": "## Chapter 3. Fact Tables",
      "content": "Details the creation of various fact tables:\n\n*   Common elements: source tables, data transformations, final selection, table schema\n*   **3.1. fct_campaign**\n    *   Source: `prep_campaign`\n    *   Key fields: `dim_campaign_id`, `campaign_owner_id`, `created_date`, `budgeted_cost`, `expected_response`, `actual_cost`, `amount_all_opportunities`, `planned_inquiry`, `planned_mql`\n*   **3.2. fct_crm_person**\n    *   Source: `prep_crm_person`, `map_crm_account`, `dim_sales_segment`, `prep_sales_territory`, `prep_industry`, `prep_bizible_marketing_channel_path`, `prep_crm_user_hierarchy`, `sfdc_contacts`, `sfdc_leads`\n    *   Key fields: `dim_crm_person_id`, `dim_crm_account_id`, `dim_crm_user_id`, `created_date`, `inquiry_date`, `mql_date_first`, `mql_date_latest`, `is_mql`, `is_inquiry`, `person_score`, `mql_count`\n*   **3.3. fct_crm_touchpoint**\n    *   Source: `prep_crm_touchpoint`, `map_crm_account`, `prep_crm_person`\n    *   Key fields: `dim_crm_touchpoint_id`, `dim_crm_person_id`, `dim_campaign_id`, `dim_crm_account_id`, `bizible_count_first_touch`, `bizible_count_lead_creation_touch`, `bizible_count_u_shaped`"
    },
    {
      "name": "## Chapter 4. Preparation Tables",
      "content": "Details the creation of the various preparation tables used as source for fact and dimension tables, including:\n\n*   Common elements: source tables, data transformations, final selection, table schema\n*   **4.1. prep_crm_attribution_touchpoint**\n    *   Source: `sfdc_bizible_attribution_touchpoint_source`\n    *   Key transformations: Cleans and categorizes bizible form URLs and touchpoint offer types\n*   **4.2. prep_date**\n    *   Source: `date_details_source`\n    *   Key transformations: Provides a comprehensive date dimension\n*   **4.3. prep_crm_user_hierarchy**\n    *   Source: `prep_crm_user_daily_snapshot`, `prep_crm_user`, `prep_crm_account_daily_snapshot`, `prep_sales_funnel_target`, `prep_crm_person`\n    *   Key transformations: Combines user and account hierarchies to create a comprehensive organizational structure.\n*   **4.4. prep_crm_user**\n    *   Source: `sfdc_users_source`, `sfdc_user_roles_source`, `sheetload_mapping_sdr_sfdc_bamboohr_source`\n    *   Key transformations: Derives user attributes such as sales segment, geo, and role information\n*   **4.5. prep_campaign**\n    *   Source: `sfdc_campaign_source`\n    *   Key transformations: Cleans and formats campaign data\n*   **4.6. prep_crm_person**\n    *   Source: `sfdc_contacts`, `sfdc_leads`, `biz_person`, `biz_touchpoints`\n    *   Key transformations: Combines lead and contact data, performs data cleaning, and calculates key metrics related to MQLs and inquiries\n*   **4.7. prep_crm_touchpoint**\n    *   Source: `sfdc_bizible_touchpoint_source`\n    *   Key transformations: Cleans and categorizes bizible form URLs and touchpoint offer types\n*   **4.8. prep_bizible_marketing_channel_path**\n    *   Source: `map_bizible_marketing_channel_path`\n    *   Key transformations: Maps bizible marketing channels into broader categories\n*   **4.9. prep_sales_territory**\n    *   Source: `prep_sfdc_account`\n    *   Key transformations: Creates sales territory dimension keys\n*   **4.10. prep_bizible_touchpoint_keystone**\n    *   Source: `content_keystone_source`, `prep_crm_attribution_touchpoint`, `prep_crm_touchpoint`\n    *   Key transformations: Identifies and maps touchpoints to keystone content based on URL and campaign data\n*   **4.11. prep_industry**\n    *   Source: `prep_sfdc_account`\n    *   Key transformations: Creates industry dimension keys"
    },
    {
      "name": "## Chapter 5. Restricted Safe Preparation Tables",
      "content": "Details the creation of restricted safe preparation tables:\n\n*   **5.1. prep_crm_account**\n    *   Source: `sfdc_account`, `map_merged_crm_account`, `prep_crm_person`, `sfdc_user_roles_source`\n    *   Key transformations: Combines account data with ultimate parent information, applies mappings, and derives metrics like employee count band\n*   **5.2. prep_charge_mrr**\n    *   Source: `prep_charge`, `prep_date`\n    *   Key transformations: Calculates monthly recurring revenue (MRR) for active subscriptions"
    },
    {
      "name": "## Chapter 6. SFDC Preparation Tables",
      "content": "Details the creation of SFDC preparation tables:\n\n*   **6.1. sfdc_lead_source**\n    *   Source: `lead`\n    *   Key transformations: cleaning and transformation of lead data\n*   **6.2. sfdc_contact_source**\n    *   Source: `contact`\n    *   Key transformations: cleaning and transformation of contact data\n*   **6.3. sfdc_bizible_touchpoint_source**\n    *   Source: `bizible2__bizible_touchpoint__c`\n    *   Key transformations: cleaning and transformation of bizible touchpoint data.\n*   **6.4. sfdc_users_source**\n    *   Source: `user`\n    *   Key transformations: cleaning and transformation of user data.\n*   **6.5. sfdc_campaign_source**\n    *   Source: `campaign`\n    *   Key transformations: cleaning and transformation of campaign data.\n*   **6.6. sfdc_account_source**\n    *   Source: `account`\n    *   Key transformations: cleaning and transformation of account data\n*   **6.7. sfdc_user_roles_source**\n    *   Source: `userrole`\n    *   Key transformations: cleaning and transformation of user role data.\n*   **6.8. sfdc_bizible_attribution_touchpoint_source**\n    *   Source: `bizible2__bizible_attribution_touchpoint__c`\n    *   Key transformations: cleaning and transformation of bizible attribution touchpoint data."
    },
    {
      "name": "## Chapter 7. Other Preparation Tables",
      "content": "Details the creation of the remaining preparation tables used in the data pipeline:\n\n*   **7.1. sheetload_devrel_influenced_campaigns_source**\n    *   Source: `devrel_influenced_campaigns`\n    *   Key transformations: loads and cleans DevRel influenced campaign data.\n*   **7.2. prep_sales_territory**\n    *   Source: `zuora_country_geographic_region`\n    *   Key transformations: cleaning and transformation of sales territory data.\n*   **7.3. prep_bizible_marketing_channel_path**\n    *   Source: `map_bizible_marketing_channel_path`\n    *   Key transformations: transformation of bizible marketing channel paths data.\n*   **7.4. Zuora Order Actions**\n    *   Source: `orderaction`\n    *   Key transformations: Transformation of Zuora order action data\n*   **7.5. Zuora Order**\n    *   Source: `ORDER`\n    *   Key transformations: Transformation of Zuora order data\n*   **7.7. prep_pte_scores_source**\n    *   Source: `pte_scores`\n    *   Key transformations: Transformation of PTE scores data \n*   **7.8. prep_ptc_scores_source**\n    *   Source: `ptc_scores`\n    *   Key transformations: Transformation of PTC scores data\n*   **7.9. Other Sources**\n    *   Source: `prep_crm_task`, `prep_crm_event`, `prep_sales_segment`, `prep_location_region`, `sfdc_account_snapshots_source`, `sfdc_user_snapshots_source`, `Zuora Rate Plan Charge`, `Marketo Lead`\n    *   Key transformations: clean and format of core data"
    },
    {
      "name": "## Chapter 8. Mapping Tables",
      "content": "Details the structure and purpose of the various mapping tables used in the data pipeline, focusing on how they relate source data to dimension keys:\n\n*   **8.1. map_bizible_campaign_grouping**\n    *   Source: `bizible_touchpoints`, `campaign`\n    *   Key fields: `dim_crm_touchpoint_id`, `dim_campaign_id`, `integrated_campaign_grouping`, `gtm_motion`, `touchpoint_segment`\n*   **8.2. map_bizible_marketing_channel_path**\n    *   Source: `touchpoints`\n    *   Key fields: `bizible_marketing_channel_path`, `bizible_marketing_channel_path_name_grouped`\n*   **8.3. map_crm_account**\n    *   Source: `prep_sfdc_account`, `dim_sales_segment`, `dim_sales_territory`, `dim_industry`, `prep_location_country`\n    *   Key fields: `dim_crm_account_id`, `dim_parent_crm_account_id`, `dim_account_sales_segment_id`, `dim_account_sales_territory_id`, `dim_account_industry_id`, `dim_account_location_country_id`, `dim_account_location_region_id`\n*8.4. Other mapping tables\n     *Source: zuora_country_geographic_region, Zuora Order Action Rate Plan, charge_contractual_value, User Hierarchy"
    }
  ]
}